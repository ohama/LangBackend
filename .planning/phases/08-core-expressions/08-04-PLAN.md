---
phase: 08-core-expressions
plan: 04
type: execute
wave: 4
depends_on: [08-03]
files_modified:
  - tests/compiler/07-comparison-equal.flt
  - tests/compiler/08-comparison-less.flt
  - tests/compiler/09-boolean-and.flt
  - tests/compiler/10-let-simple.flt
  - tests/compiler/11-let-nested.flt
  - tests/compiler/12-if-else-simple.flt
  - tests/compiler/13-if-else-complex.flt
  - tests/FunLang.Compiler.Tests/MlirBindingsTests.fs
autonomous: true

must_haves:
  truths:
    - "E2E fslit tests cover all Phase 8 features"
    - "All fslit tests pass via Makefile"
    - "All unit tests pass"
    - "Phase 8 requirements fully verified"
  artifacts:
    - path: "tests/compiler/07-comparison-equal.flt"
      provides: "E2E test for equality comparison"
    - path: "tests/compiler/12-if-else-simple.flt"
      provides: "E2E test for if-else"
  key_links:
    - from: "tests/compiler/*.flt"
      to: "src/FunLang.Compiler.Cli"
      via: "fslit test harness"
      pattern: "dotnet run --project src/FunLang.Compiler.Cli"
---

<objective>
Add comprehensive E2E tests for all Phase 8 features using fslit test framework

Purpose: Verify that the complete compilation pipeline (parse -> MLIR -> lower -> JIT) works correctly for comparisons, booleans, let bindings, and if-else. These tests complement unit tests by testing the full CLI-driven workflow.

Output: New fslit test files in tests/compiler/, all tests passing.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/08-core-expressions/08-01-SUMMARY.md
@.planning/phases/08-core-expressions/08-02-SUMMARY.md
@.planning/phases/08-core-expressions/08-03-SUMMARY.md

# Existing test pattern
@tests/compiler/01-constant.flt
@tests/Makefile
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create E2E tests for comparisons and booleans</name>
  <files>
tests/compiler/07-comparison-equal.flt
tests/compiler/08-comparison-less.flt
tests/compiler/09-comparison-chain.flt
tests/compiler/10-boolean-and.flt
tests/compiler/11-boolean-or.flt
  </files>
  <action>
Create fslit test files for comparison and boolean operations.

Note: Since compileAndRun returns i32 and booleans are i1, these tests must use if-else to convert boolean results to integers.

**tests/compiler/07-comparison-equal.flt:**
```
// Test: equality comparison
// --- Command: dotnet run --project src/FunLang.Compiler.Cli -- %input
// --- Input:
if 5 = 5 then 1 else 0
// --- Output:
1
```

**tests/compiler/08-comparison-less.flt:**
```
// Test: less-than comparison
// --- Command: dotnet run --project src/FunLang.Compiler.Cli -- %input
// --- Input:
if 3 < 5 then 1 else 0
// --- Output:
1
```

**tests/compiler/09-comparison-chain.flt:**
```
// Test: multiple comparisons with arithmetic
// --- Command: dotnet run --project src/FunLang.Compiler.Cli -- %input
// --- Input:
if (2 + 3) = 5 then (if 10 > 5 then 100 else 50) else 0
// --- Output:
100
```

**tests/compiler/10-boolean-and.flt:**
```
// Test: logical AND
// --- Command: dotnet run --project src/FunLang.Compiler.Cli -- %input
// --- Input:
if true && true then 1 else 0
// --- Output:
1
```

**tests/compiler/11-boolean-or.flt:**
```
// Test: logical OR
// --- Command: dotnet run --project src/FunLang.Compiler.Cli -- %input
// --- Input:
if false || true then 1 else 0
// --- Output:
1
```
  </action>
  <verify>Tests pass: `make -C tests compiler`</verify>
  <done>E2E fslit tests for comparisons and booleans pass</done>
</task>

<task type="auto">
  <name>Task 2: Create E2E tests for let bindings</name>
  <files>
tests/compiler/12-let-simple.flt
tests/compiler/13-let-nested.flt
tests/compiler/14-let-shadow.flt
  </files>
  <action>
Create fslit test files for let bindings.

**tests/compiler/12-let-simple.flt:**
```
// Test: simple let binding
// --- Command: dotnet run --project src/FunLang.Compiler.Cli -- %input
// --- Input:
let x = 5 in x + 10
// --- Output:
15
```

**tests/compiler/13-let-nested.flt:**
```
// Test: nested let bindings
// --- Command: dotnet run --project src/FunLang.Compiler.Cli -- %input
// --- Input:
let a = 1 in let b = 2 in let c = 3 in a + b + c
// --- Output:
6
```

**tests/compiler/14-let-shadow.flt:**
```
// Test: let binding with shadowing
// --- Command: dotnet run --project src/FunLang.Compiler.Cli -- %input
// --- Input:
let x = 5 in let x = 10 in x
// --- Output:
10
```
  </action>
  <verify>Tests pass: `make -C tests compiler`</verify>
  <done>E2E fslit tests for let bindings pass</done>
</task>

<task type="auto">
  <name>Task 3: Create E2E tests for if-else expressions</name>
  <files>
tests/compiler/15-if-else-true.flt
tests/compiler/16-if-else-false.flt
tests/compiler/17-if-else-comparison.flt
tests/compiler/18-if-else-nested.flt
tests/compiler/19-if-else-let.flt
  </files>
  <action>
Create fslit test files for if-else expressions.

**tests/compiler/15-if-else-true.flt:**
```
// Test: if-else with true condition
// --- Command: dotnet run --project src/FunLang.Compiler.Cli -- %input
// --- Input:
if true then 42 else 0
// --- Output:
42
```

**tests/compiler/16-if-else-false.flt:**
```
// Test: if-else with false condition
// --- Command: dotnet run --project src/FunLang.Compiler.Cli -- %input
// --- Input:
if false then 42 else 0
// --- Output:
0
```

**tests/compiler/17-if-else-comparison.flt:**
```
// Test: if-else with comparison condition
// --- Command: dotnet run --project src/FunLang.Compiler.Cli -- %input
// --- Input:
if 10 >= 5 then 100 else 200
// --- Output:
100
```

**tests/compiler/18-if-else-nested.flt:**
```
// Test: nested if-else
// --- Command: dotnet run --project src/FunLang.Compiler.Cli -- %input
// --- Input:
if true then (if false then 1 else 2) else 3
// --- Output:
2
```

**tests/compiler/19-if-else-let.flt:**
```
// Test: if-else with let binding
// --- Command: dotnet run --project src/FunLang.Compiler.Cli -- %input
// --- Input:
let x = 5 in if x < 10 then x * 2 else x
// --- Output:
10
```
  </action>
  <verify>Tests pass: `make -C tests compiler`</verify>
  <done>E2E fslit tests for if-else expressions pass</done>
</task>

</tasks>

<verification>
1. All fslit tests pass: `make -C tests compiler`
2. All unit tests pass: `dotnet test tests/FunLang.Compiler.Tests`
3. Test count increased: At least 13 new E2E tests (7-19)
4. All Phase 8 requirements have test coverage:
   - IMPL-LANG-01: Arithmetic (existing tests)
   - IMPL-LANG-02: Comparisons (tests 07-09)
   - IMPL-LANG-03: Booleans (tests 10-11)
   - IMPL-LANG-04: Let bindings (tests 12-14)
   - IMPL-LANG-05: If-else (tests 15-19)
</verification>

<success_criteria>
- All new fslit tests (07-19) pass via `make -C tests compiler`
- All existing tests continue to pass
- Complete requirement coverage for Phase 8
- Both unit tests and E2E tests verify correct behavior
</success_criteria>

<output>
After completion, create `.planning/phases/08-core-expressions/08-04-SUMMARY.md`
</output>
